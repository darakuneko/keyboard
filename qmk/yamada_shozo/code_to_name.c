//0 - 255
const char code_to_name[] PROGMEM = {
  "NO      "
  "TRNS    "
  "POSTFAIL"
  "UNDEF   "
  "A       "
  "B       "
  "C       "
  "D       "
  "E       "
  "F       "
  "G       "
  "H       "
  "I       "
  "J       "
  "K       "
  "L       "
  "M       "
  "N       "
  "O       "
  "P       "
  "Q       "
  "R       "
  "S       "
  "T       "
  "U       "
  "V       "
  "W       "
  "X       "
  "Y       "
  "Z       "
  "1       "
  "2       "
  "3       " 
  "4       "
  "5       "
  "6       "
  "7       "
  "8       "
  "9       "
  "0       "
  "ENTER   "
  "ESCAPE  "
  "BCKSPACE"
  "TAB     "
  "SPACE   "
  "-       "
  "=       "
  "[       "
  "]       "
  "\\       "
  "NNSHASH "
  ";       "
  "'       "
  "`       "
  ",       "
  ".       "
  "/       "
  "CAPSLOCK"
  "F1      "
  "F2      "
  "F3      "
  "F4      "
  "F5      "
  "F6      "
  "F7      "
  "F8      "
  "F9      "
  "F10     "
  "F11     "
  "F12     "
  "PSCREEN "
  "SCRLLLCK"
  "PAUSE   "
  "INSERT  "
  "HOME    "
  "PGUP    "
  "DEL     "
  "END     "
  "PGDOWN  "
  "RIGHT   "
  "LEFT    "
  "DOWN    "
  "UP      "
  "NUMLCK  "
  "KP_SLASH"
  "KP_AST  "
  "KP_MINUS"
  "KP_PLUS "
  "KC_PENT "
  "P1      "
  "P2      "
  "P3      "
  "P4      "
  "P5      "
  "P6      "
  "P7      "
  "P8      "
  "P9      "
  "P0      "
  "KP_DOT  "
  "NNBSLASH"
  "APP     "
  "POWER   "
  "EQUAL   "
  "F13     "
  "F14     "
  "F15     "
  "F16     "
  "F17     "
  "F18     "
  "F19     "
  "F20     "
  "F21     "
  "F22     "
  "F23     "
  "F24     "
  "EXECUTE "
  "HELP    "
  "MENU    "
  "SELECT  "
  "STOP    "
  "AGAIN   "
  "UNDO    "
  "CUT     "
  "COPY    "
  "PASTE   "
  "FIND    "
  "MUTE    "
  "VOLUP   "
  "VOLDOWN "
  "LCCAPS  "
  "LCNUM   "
  "LCSCROLL"
  "COMMA   "
  "KPEQAS4 "
  "INT1    "
  "INT2    "
  "INT3    "
  "INT4    "
  "INT5    "
  "INT6    "
  "INT7    "
  "INT8    "
  "INT9    "
  "LAN1    "
  "LAN2    "
  "LAN3    "
  "LAN4    "
  "LAN5    "
  "LAN6    "
  "LAN7    "
  "LAN8    "
  "LAN9    "
  "ALTERASE"
  "SYSREQ  "
  "CANCEL  "
  "CLEAR   "
  "PRIOR   "
  "Return  "
  "SEPARATR"
  "OUT     "
  "OPER    "
  "CLRAGAIN"
  "CRSEL   "
  "EXSEL   "
  "POWER   "
  "SLEEP   "
  "WAKE    "
  "MUTE    "
  "VOL_UP  "
  "VOL_DOWN"
  "MNTRACK "
  "MPTRACK "
  "MSTOP   "
  "MPPAUSE "
  "MSELECT "
  "EJECT   "
  "MAIL    "
  "CALC    "
  "MYCM    "
  "WSEARCH "
  "WHOME   "
  "WBACK   "
  "WFORWARD"
  "WSTOP   "
  "WREFRESH"
  "WFAVORIT"
  "MFASTFWD"
  "MFASTRWD"
  "BRIU    "
  "BRID    "
  "        "
  "FN0     "
  "FN1     "
  "FN2     "
  "FN3     "
  "FN4     "
  "FN5     "
  "FN6     "
  "FN7     "
  "FN8     "
  "FN9     "
  "FN10    "
  "FN11    "
  "FN12    "
  "FN13    "
  "FN14    "
  "FN15    "
  "FN16    "
  "FN17    "
  "FN18    "
  "FN19    "
  "FN20    "
  "FN21    "
  "FN22    "
  "FN23    "
  "FN24    "
  "FN25    "
  "FN26    "
  "FN27    "
  "FN28    "
  "FN29    "
  "FN30    "
  "FN31    "
  "LCTL    "
  "LSFT    "
  "LALT    "
  "LGUI    "
  "RCTL    "
  "RSFT    "
  "RALT    "
  "RGUI    "
};

//542 - 568
const char code_to_name542[] PROGMEM = {
  "!       "
  "@       "
  "#       "
  "$       "
  "%       "
  "^       "
  "&       "
  "*       "
  "(       "
  ")       "
  "        "
  "        "
  "        "
  "        "
  "        "
  "_       "
  "+       "
  "{       "
  "}       "
  "|       "
  "        "
  ":       "
  "\"       "
  "~       "
  "<       "
  ">       "
  "?       "
};

//20496 - 20503
const char code_to_name20496[] PROGMEM = {
  "TO(0)   "
  "TO(1)   "
  "TO(2)   "
  "TO(3)   "
  "TO(4)   "
  "TO(5)   "
  "TO(6)   "
  "TO(7)   "
};

//20736 - 20743
const char code_to_name20736[] PROGMEM = {
  "MO(0)   "
  "MO(1)   "
  "MO(2)   "
  "MO(3)   "
  "MO(4)   "
  "MO(5)   "
  "MO(6)   "
  "MO(7)   "
};

//21248 - 21255
const char code_to_name21248[] PROGMEM = {
  "TG(0)   "
  "TG(1)   "
  "TG(2)   "
  "TG(3)   "
  "TG(4)   "
  "TG(5)   "
  "TG(6)   "
  "TG(7)   "
};

//21504 - 21511
const char code_to_name21504[] PROGMEM = {
  "OSL(0)  "
  "OSL(1)  "
  "OSL(2)  "
  "OSL(3)  "
  "OSL(4)  "
  "OSL(5)  "
  "OSL(6)  "
  "OSL(7)  "
};

//22528 - 22535
const char code_to_name22528[] PROGMEM = {
  "TT(0)   "
  "TT(1)   "
  "TT(2)   "
  "TT(3)   "
  "TT(4)   "
  "TT(5)   "
  "TT(6)   "
  "TT(7)   "
};

//23552 - 23745
const char code_to_name23552[] PROGMEM = {
  "RESET   "
  "DEBUG   "
  "CL_SWAP "
  "CL_CTRL "
  "LAG_SWP "
  "RAG_SWP "
  "GUI_OFF "
  "GE_SWAP "
  "BS_SWAP "
  "NK_ON   "
  "AG_SWAP "
  "CL_NORM "
  "CL_CAPS "
  "LAG_NRM "
  "RAG_NRM "
  "GUI_ON  "
  "GE_SWAP "
  "BS_NORM "
  "NK_OFF  "
  "AG_NORM "
  "NK_TOGG "
  "AG_TOGG "
  "GRAVEESC"
  "AS_UP   "
  "AS_DN   "
  "AS_RP   "
  "AS_TG   "
  "AS_ON   "
  "AS_OFF  "
  "AUDIOON "
  "AUDIOOFF"
  "AUDIOTOG"
  "AUCLKTOG"
  "CLKENA  "
  "CLKDIS  "
  "CLKUP   "
  "CLKDOWN "
  "CLKRESET"
  "MUSICON "
  "MUSICOFF"
  "MUSICTOG" 
  "MUSICMOD" 
  "        "
  "        "
  "MIDION  " 
  "MIDIOFF " 
  "MIDITOG " 
  "MI_C_0  " 
  "MI_Cs_0 " 
  "MI_D_0  " 
  "MI_Ds_0 " 
  "MI_E_0  " 
  "MI_F_0  " 
  "MI_Fs_0 " 
  "MI_G_0  " 
  "MI_Gs_0 " 
  "MI_A_0  " 
  "MI_As_0 " 
  "MI_B_0  " 
  "MI_C_1  " 
  "MI_Cs_1 " 
  "MI_D_1  " 
  "MI_Ds_1 " 
  "MI_E_1  " 
  "MI_F_1  " 
  "MI_Fs_1 " 
  "MI_G_1  " 
  "MI_Gs_1 " 
  "MI_A_1  " 
  "MI_As_1 " 
  "MI_B_1  " 
  "MI_C_2  " 
  "MI_Cs_2 " 
  "MI_D_2  " 
  "MI_Ds_2 " 
  "MI_E_2  " 
  "MI_F_2  " 
  "MI_Fs_2 " 
  "MI_G_2  " 
  "MI_Gs_2 " 
  "MI_A_2  " 
  "MI_As_2 " 
  "MI_B_2  " 
  "MI_C_3  " 
  "MI_Cs_3 " 
  "MI_D_3  " 
  "MI_Ds_3 " 
  "MI_E_3  " 
  "MI_F_3  " 
  "MI_Fs_3 " 
  "MI_G_3  " 
  "MI_Gs_3 " 
  "MI_A_3  " 
  "MI_As_3 " 
  "MI_B_3  " 
  "MI_C_4  " 
  "MI_Cs_4 " 
  "MI_D_4  " 
  "MI_Ds_4 " 
  "MI_E_4  " 
  "MI_F_4  " 
  "MI_Fs_4 " 
  "MI_G_4  " 
  "MI_Gs_4 " 
  "MI_A_4  " 
  "MI_As_4 " 
  "MI_B_4  " 
  "MI_C_5  " 
  "MI_Cs_5 " 
  "MI_D_5  " 
  "MI_Ds_5 " 
  "MI_E_5  " 
  "MI_F_5  " 
  "MI_Fs_5 " 
  "MI_G_5  " 
  "MI_Gs_5 " 
  "MI_A_5  " 
  "MI_As_5 " 
  "MI_B_5  " 
  "MI_OCTN2"
  "MI_OCTN1"
  "MI_OCT_0"
  "MI_OCT_1"
  "MI_OCT_2"
  "MI_OCT_3"
  "MI_OCT_4"
  "MI_OCT_5"
  "MI_OCT_6"
  "MI_OCT_7"
  "MI_OCTDN"
  "MI_OCTUP"
  "MITRNSN6"
  "MITRNSN5"
  "MITRNSN4"
  "MITRNSN3"
  "MITRNSN2"
  "MITRNSN1"
  "MI_TRNS0"
  "MI_TRNS1"
  "MI_TRNS2"
  "MI_TRNS3"
  "MI_TRNS4"
  "MI_TRNS5"
  "MI_TRNS6"
  "MI_TRNSD"
  "MI_TRNSU"
  "MI_VEL_1"
  "MI_VEL_2"
  "MI_VEL_3"
  "MI_VEL_4"
  "MI_VEL_5"
  "MI_VEL_6"
  "MI_VEL_7"
  "MI_VEL_8"
  "MI_VEL_9"
  "MI_VEL10"
  "MI_VELDN"
  "MI_VELUP"
  "MI_CH1  "
  "MI_CH2  "
  "MI_CH3  "
  "MI_CH4  "
  "MI_CH5  "
  "MI_CH6  "
  "MI_CH7  "
  "MI_CH8  "
  "MI_CH9  "
  "MI_CH10 "
  "MI_CH11 "
  "MI_CH12 "
  "MI_CH13 "
  "MI_CH14 "
  "MI_CH15 "
  "MI_CH16 "
  "MI_CHDN "
  "MI_CHUP "
  "MI_ALLOF"
  "MI_SUS  "
  "MI_PORT "
  "MI_SOST "
  "MI_SOFT "
  "MI_LEG  "
  "MI_MOD  "
  "MI_MODSD"
  "MI_MODSU"
  "MI_BENDD"
  "MI_BENDU"
  "BL_ON   "
  "BL_OFF  "
  "BL_DEC  "
  "BL_INC  "
  "BL_TOGG "
  "BL_STEP "
  "BL_BRTG "
};

//23746 - 23766
const char code_to_name23746[] PROGMEM = {
  "RGB_TOG "
  "RGB_M_FR"
  "RGB_M_RE"
  "RGB_HUI "
  "RGB_HUD "
  "RGB_SAI "
  "RGB_SAD "
  "RGB_VAI "
  "RGB_VAD "
  "RGB_SPI "
  "RGB_SPD "
  "RGB_M_PL"
  "RGB_M_BR"
  "RGB_M_RN"
  "RGB_M_SW"
  "RGB_M_SN"
  "RGB_M_KN"
  "RGB_M_XM"
  "RGB_M_GR"
  "RGB_M_T"
};

//23767 - 23775
const char code_to_name23767[] PROGMEM = {
  "        "
  "LSPO    "
  "RSPC    "
  "SFTENT  "
  "        "
  "        "
  "OUT_AUTO"
  "OUT_USB "
  "EEP_RST "
};

//23795 - 23810
const char code_to_name23795[] PROGMEM = {
  "LCPO    "
  "RCPC    "
  "LAPO    "
  "RAPC    "
  "CMB_ON  "
  "CMB_OFF "
  "CMB_TOG "
  "LCG_SWP "
  "RCG_SWP "
  "LCG_NRM "
  "RCG_NRM "
  "CG_SWAP "
  "CG_NORM "
  "CG_TOGG "
  "EH_LEFT "
  "EH_RGHT "
};

//23849
const char code_to_name23849[] PROGMEM = {
  "OUT_BT  "
};

//23907 - 23909
const char code_to_name23907[] PROGMEM = {
  "DT_PRNT "
  "DT_UP   "
  "DT_DOWN "
};

//24336 - 24353
const char code_to_name24336[] PROGMEM = {
  "FN_MO13 "
  "FN_MO23 "
  "MACRO00 "
  "MACRO01 "
  "MACRO02 "
  "MACRO03 "
  "MACRO04 "
  "MACRO05 "
  "MACRO06 "
  "MACRO07 "
  "MACRO08 "
  "MACRO09 "
  "MACRO10 "
  "MACRO11 "
  "MACRO12 "
  "MACRO13 "
  "MACRO14 "
  "MACRO15 "
};

#define NAME_LENGH 15
#define CODE_NAME_LENGH 8
#define NUM_USB_HID_KEYCODES 255

#define LCTR_FIRST 256
#define LSHFT_FIRST 512
#define LCTR_SHIFT_FIRST 768
#define LALT_FIRST 1024
#define LCTR_ALT_FIRST 1280
#define LSHFT_ALT_FIRST 1536
#define LCTR_SHIFT_ALT_FIRST 1792
#define LGUI_FIRST 2048
#define LCTR_GUI_FIRST 2304
#define LSHIFT_GUI_FIRST 2560
#define LCTR_SHIFT_GUI_FIRST 2816
#define LALT_GUI_FIRST 3072
#define LCTR_ALT_GUI_FIRST 3328
#define LSHIFT_ALT_GUI_FIRST 3584
#define LCTR_SHIFT_ALT_GUI_FIRST 3840
#define RCTR_FIRST 4352
#define LAYER_KEYCODES_FIRST 16384
#define LAYER_KEYCODES_LAST 18175
#define L_HOLD_TAP_CTR_FIRST 24832
#define R_HOLD_TAP_CTR_FIRST 28928

#define MOD_PLUS "+"
#define HOLD_TAP "/"

uint16_t mods_keycode[] = {
  LCTR_FIRST,
  LSHFT_FIRST,
  LCTR_SHIFT_FIRST,
  LALT_FIRST,
  LCTR_ALT_FIRST,
  LSHFT_ALT_FIRST,
  LCTR_SHIFT_ALT_FIRST,
  LGUI_FIRST,
  LCTR_GUI_FIRST,
  LSHIFT_GUI_FIRST,
  LCTR_SHIFT_GUI_FIRST, 
  LALT_GUI_FIRST,
  LCTR_ALT_GUI_FIRST,
  LSHIFT_ALT_GUI_FIRST,
  LCTR_SHIFT_ALT_GUI_FIRST
};

char mods_name[][6] = {
  "-CTR",
  "-SHFT",
  "-CS",
  "-ALT",
  "-CA",
  "-SA",
  "-CSA",
  "-GUI",
  "-CG",
  "-SG",
  "-CSG",
  "-AG",
  "-CAG",
  "-SAG",
  "-CSAG"
};

char name[NAME_LENGH] = "";

void init_name(void) {
  for (uint8_t i = 0; i < NAME_LENGH; i++) {
      name[i] = '\0';
  }
};

void _set_code_to_name(const char * code_to_name, uint16_t keycode, uint8_t idx) {
  for (uint8_t i = idx; i < NAME_LENGH; i++) {
    if(i < CODE_NAME_LENGH + idx){
      name[i] = pgm_read_byte(code_to_name + keycode * CODE_NAME_LENGH + (i - idx));
    } else {
      name[i] = '\0';
    }
  }
};

void mk_pre_name(const char * pre, uint8_t i, const char * ext){
  init_name();
  strcat(name, pre);
  strcat(name, mods_name[i]);
  strcat(name, ext);
};

void set_mod_mask_code_to_name(uint16_t keycode, const char * pre, const char * ext){
  int b = 0;
  
  for (uint8_t i = 0; i < 15; i++) {
    if(keycode >= mods_keycode[i] && keycode <= mods_keycode[i] + NUM_USB_HID_KEYCODES){
      if(strcmp(ext, (char*)&MOD_PLUS) == 0 && keycode >= 542 && keycode <= 568){
        _set_code_to_name(code_to_name542, keycode - 542, 0);
        b = 1;
      } else {
        mk_pre_name(pre, i, ext);
        _set_code_to_name(code_to_name, keycode - mods_keycode[i], strlen(mods_name[i]) + 2);
        b = 1;
      } 
    }

    if(b == 1){
      break;
    }
  }
};

void set_layer_code_to_name(uint16_t keycode) {
  uint16_t keycode_start = LAYER_KEYCODES_FIRST;
  char num[]="0123456789";
  for (int i = 0; i < 7; i++) {
    if(keycode >= keycode_start  && keycode <= (keycode_start + NUM_USB_HID_KEYCODES)){
      init_name();
      name[0] = 'L';
      name[1] = num[i];
      name[2] = '/';
      _set_code_to_name(code_to_name, keycode - keycode_start, 3);
    }
    keycode_start = keycode_start + NUM_USB_HID_KEYCODES + 1;
  }
};

void set_code_to_name(uint16_t keycode) {
    if(keycode <= NUM_USB_HID_KEYCODES){
      _set_code_to_name(code_to_name, keycode, 0);
    } 

    else if(keycode >= LCTR_FIRST && keycode <= LCTR_SHIFT_ALT_GUI_FIRST + NUM_USB_HID_KEYCODES){
      set_mod_mask_code_to_name(keycode, "L", MOD_PLUS);
    }
    else if(keycode >= RCTR_FIRST && keycode <= RCTR_FIRST + LCTR_SHIFT_ALT_GUI_FIRST + NUM_USB_HID_KEYCODES){
      set_mod_mask_code_to_name(keycode - RCTR_FIRST + LCTR_FIRST, "R", MOD_PLUS);
    }

    else if(keycode >= LAYER_KEYCODES_FIRST && keycode <= LAYER_KEYCODES_LAST){
      set_layer_code_to_name(keycode);
    } 

    else if(keycode >= 20496 && keycode <= 20503){
      _set_code_to_name(code_to_name20496, keycode - 20496, 0);
    } else if(keycode >= 20736 && keycode <= 20743){
      _set_code_to_name(code_to_name20736, keycode - 20736, 0);
    } else if(keycode >= 21248 && keycode <= 21255){
      _set_code_to_name(code_to_name21248, keycode - 21248, 0);
    } else if(keycode >= 21504 && keycode <= 21511){
      _set_code_to_name(code_to_name21504, keycode - 21504, 0);
    } else if(keycode >= 22528 && keycode <= 22535){
      _set_code_to_name(code_to_name22528, keycode - 22528, 0);
    } else if(keycode >= 23552 && keycode <= 23745){
      _set_code_to_name(code_to_name22528, keycode - 23552, 0);
    } else if(keycode >= 23746 && keycode <= 23766){
      _set_code_to_name(code_to_name23746, keycode - 23746, 0);
    } else if(keycode >= 23767 && keycode <= 23775){
      _set_code_to_name(code_to_name23767, keycode - 23767, 0);
    } else if(keycode >= 23795 && keycode <= 23810){
      _set_code_to_name(code_to_name23795, keycode - 23795, 0);
    } else if(keycode >= 23849 && keycode <= 23849){
      _set_code_to_name(code_to_name23849, keycode - 23849, 0);
    } else if(keycode >= 23906 && keycode <= 23908){
      _set_code_to_name(code_to_name23907, keycode - 23906, 0);
    } else if(keycode >= 24336 && keycode <= 24353){
      _set_code_to_name(code_to_name23907, keycode - 24336, 0);
    } 
     
    else if(keycode >= L_HOLD_TAP_CTR_FIRST && keycode <= L_HOLD_TAP_CTR_FIRST + LCTR_SHIFT_ALT_GUI_FIRST + NUM_USB_HID_KEYCODES){
      set_mod_mask_code_to_name(keycode - L_HOLD_TAP_CTR_FIRST + LCTR_FIRST, "L", HOLD_TAP);
    }
    else if(keycode >= R_HOLD_TAP_CTR_FIRST && keycode <= R_HOLD_TAP_CTR_FIRST + LCTR_SHIFT_ALT_GUI_FIRST + NUM_USB_HID_KEYCODES){
      set_mod_mask_code_to_name(keycode - R_HOLD_TAP_CTR_FIRST + LCTR_FIRST, "R", HOLD_TAP);
    }
    
    else {
      init_name();
      strcat(name, "UNDEF-KEY");
      //itoa(keycode, name, 10);
    }
};
